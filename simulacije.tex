\documentclass[a4paper,11pt]{book}

% Paketi za nas jezik (optimalni)
\usepackage{cmsrb}
\usepackage[OT2,T1]{fontenc}
\usepackage[serbian]{babel}

\usepackage{graphicx}
\usepackage{lmodern}
\usepackage{hyperref}
\usepackage{listings}


\makeatletter
\newenvironment{chapquote}[2][2em]
  {\setlength{\@tempdima}{#1}%
   \def\chapquote@author{#2}%
   \parshape 1 \@tempdima \dimexpr\textwidth-2\@tempdima\relax%
   \itshape}
  {\par\normalfont\hfill--\ \chapquote@author\hspace*{\@tempdima}\par\bigskip}
\makeatother

\title{\Huge \textbf{Modelovanje autonomnog sistema za kompaktan uzgoj biljaka} \\ \huge Modelovanje i simulacije}
\author{\textsc{Aleksandar Stojanović RN97-2018}}


\begin{document}

\maketitle
\tableofcontents

%\mainmatter
\chapter*{Uvod}

\section*{Svrha rada}
Ovaj rad je stvoren sa ciljem da opiše jednostavno i pristupačno rešenje za proizvodnju hrane u veštačkim uslovima.\\

\noindent U ovom radu prezentovaću svoj pristup dizajniranja ovakvog sistema. Detaljno cu analizirati principe rada individualnih podsistema koji sačinjavaju ovu jedinicu i simulirati njihov rad.

\section*{Uzgoj u zastvorenom prostoru}
Ovakav vid proizvodnje sa urbanizacijom postaje sve popularniji. Kako gradovi postaju sve veći, potreba za organskom hranom raste te se ljudi okreću alternativnim metodama uzgoja.\\

Kada je reč o zatvorenim prostorima, u glavnom se misli na kontrolisano okruženje koje ima za cilj da olakša razvoj biljke pa kasnije i samih plodova. Ovo se postiže adekvatnim planiranjem što podrazumeva razmatranje i ispunjavanje svih uslova neophodnih za rast. 

\section*{Tradicionalan ili zatvoren uzgoj}
Dok nam tradicionalan pristup uzgoju olakšava logistiku i nudi dosta pogodnije mogućnosti za ekspanzije, zatvoren pristup pruža kompletno kontrolu nad samim okruženjem. Pored toga biljka je kopletno izolovana od negativnih spoljašnjih faktora kao što su:

\begin{itemize}
  \item paraziti,
  \item naglih oscilacija temperature,
  \item prevelike količine padavina.
\end{itemize}

\noindent Sama činjenica da je biljka u izolovanom okruženju nam omogućava da bliže pratimo njen razvoj. Ovo posebno dolazi do izražaja kod otkrivanja problema u ranim fazama. Pored otkrivanja problema omogućava nam optimizaciju procesa uzgoja što dovodi do efikasnije proizvodnje.

\chapter{Priprema}

%\begin{chapquote}{Author's name, \textit{Source of this quote}}
%``This is a quote and I don't know who said this.''
%\end{chapquote}

\section{Definisanje problema}
Dakle, naš cilj je izrada autonomne jedinice koja radi bez čovekovog prisustva. Kako bismo to postigli moramo se osloniti na nekakvu upravljačku jedinicu koja ce biti zadužena za kontrolu celokupnog sistema uz oslonac na senzore. 

Glavna prepreka je limitirana količina prostora koja nam je na raspolaganju. Kada je reč o uzgoju u zatvorenim prostorima podrazumeva se da nam je sam prostor jako važan resurs i potrebno je iskoristiti ga što efikasnije. Tek kada je prostor pravilno iskorišćen možemo započeti izradu ostlaih delova sistema.

Da bismo prostor koristili efektivno bitno je da unapred definišemo funkcionalnosti našeg sistema: 

\hrulefill

1. Merenje i regulacija temperature,

2. Merenje vlažnosti zemlje i ambijenta,

3. Regulacija svetlosnog ciklusa,

4. Regulacija brzine ventilatora,

5. Zalivanje biljke,

6. Logovanje 

\hrulefill

\noindent Imajuci ove funkcije na umu mozemo odrediti grub plan projekta. U sledećoj tački ćemo da detaljo definisati svaku od ovih funkcija i opisati hardver koji ćemo koristiti za izradu. Cilj nam je da hardver zauzme sto manje prostora kako bi ostalo što vise prostora za rad sa biljkom.

\section{Plana izrade projekta}

Sistem će biti smešten u kabinet dimenzija 35x35x60 koji je izradjen od metala. Ova veličina ce podržati biljku srednjih veličina. Neophodno je da unutrašnjost kabineta bude obložena reflektivnim materijalom koji će dobrineti da biljka iskoristi pun potencijal svetla. Pored reflektivnog materijala, unutrašnje ivice sistema je potrebno obložiti gumom kako bismo efektivno izolovali sistem od sredine.

Na vrh(plafon) kabineta neophodno je ugraditi nekakvo rešenje za fiksiranje svetla u vidu kuka. Za kuke se kače sajle koje će držati svetlosnu fiksturu. Na poledjini kabineta izbušićemo dve rupe za kačenje ventilatora koji ce obezbediti cirkulaciju.

\noindent \\ Budući da ovakav sistem zahteva kontinualan rad sto podrazumeva dugoročno opterećenje, Adruino Uno\footnote{Arduino Uno je open-source rešenje u vidu kontrolera za IoT projekte koji pruža mnoštvo mogućnosti. Vise na: https://www.arduino.cc/en/Guide/Introduction} je idealno rešenje jer nudmi stabilnost pod dugoročnim radom i jednostavnu integraciju senzora. Pored stabilnosti i male veličine ako pogledamo njegov dijagram možemo uočiti da imamo izlaze od 3.3V i 5V sto je idealno za napajanje senzora i releja.

Kontroler če biti smešten izvan sistema sa spoljašnje strane unutar odeljka zajedno sa protobordom za povezivanje svih komponenti i relejem. Ovo će predstavljati mozak sistema odakle ćemo rutirati kablove. Sto se samog odeljka tiče, plastična razvodna kutija je dimenzija 20cm x 20cm x 5cm je sasvim dovoljna za naše potrebe.

\includegraphics[width=\textwidth]{uno_pinout.png}

Kao monitor za feedback sistema koristicemo mali I2C\footnote{I2C protokol služi za serijsku komunikaciju sa mikrokontrolerima. Vise na: https://i2c.info/} OLED ekran 128x32 veličine 0.91 inča kao dugoročno rešenje dok će serijski port biti primarno korišćen u početnim fazama izrade.

\includegraphics[width=\textwidth]{oled.png}

\subsection{Merenje temperature i regulacija}

Čest problem sa kompaktnim zatvorenim baštama je visoka temperatura.

Merenje temperature je krucijalan korak jer je to jedan od glavnih faktora okruženja. Različite biljke zahtevaju različite uslove poput povećane vlage, stoga neophodno je koristiti adekvatan hardver.\\ 

\noindent DS18B20\footnote{Digitalni senzor toplote koji nudi 9-bit do 12-bit vrednosti toplote izražene u celizijusu. Vise na: https://datasheets.maximintegrated.com/en/ds/DS18B20.pdf} je senzor po izboru iz razloga što je fabrički izolovan, ima dosta širi opseg vrednosti od očekivanog unutar sistema i napaja se sa 3.3V ili 5.5V.

Regulaciju rešavamo korišćenjem ulaznih i izlaznih ventilatora(vise o regulaciji temperature će biti).

\subsection{Merenje vlažnosti zemlje i ambijenta}
Praćenjem vlažnosti zemlje nam omogućava da automatizovano zalivamo biljku u zavisnosti od njenih potreba. Za razliku od fiksnih ciklusa zalivanja kod kojih može doći do preteranog navodnjavanja ovde se mehanizam za navodnjavanje aktivira samo kada je to potrebno. Ovo sprečava prekomerno zalivanje sto dovodi do raznih problema poput:

\begin{itemize}
  \item Nedostatka kiseonika u zemlji za korenov sistem,
  \item gljivično oboljenje korena,
  \item nedostatak hranjivih materija usled prekomernog ispiranja
\end{itemize}

Za vlagu ambijenta koristimo HR202 senzor vlage u vazduhu, a za zemljiste koristimo kapacitivni senzor LDTR-WG0236.

\subsection{Regulacija svetlosnog ciklusa}
Različite biljke zahtevaju specifične svetlosne cikluse. Stoga, moramo konfigurisati naš kontroler po parametrima biljke kako bismo joj pružili optimalne uslove. Interval osvetljenja je konfigurisan softverski i zavisno od istog kontroler utiče na relej. 

Što se izbora tehnologije svetla tiče u opticaju imamo sledece:

\begin{itemize}
  \item LED - Light emmiting diode
  \item HID - High-intensiti discharge
  \item Flourescent(CFL)
\end{itemize}

\begin{table}[ht]
  \caption{Karakteristike različitih tehnologija}
  \centering
  \begin{tabular}{|c|c|c|c|}
  \hline
   & CFL & HID & LED \\ \hline
  Inicijalna cena & Nisko & Srednje & Nisko/skupo \\ \hline
  Potrošnja & Nisko & Srednje/Visoko & Nisko \\ \hline
  Efikasnost & Osrednje & Dobro & Dobro/Odlično \\ \hline
  Udaljenost & Mala & Srednja & Srednja/Velika \\ \hline
  \end{tabular}
\end{table}

Zbog efikasnosti i povoljne cene koristićemo LED svetla za sistem. Ova tehnologija je najbolja opcija za nas jer imamo dovoljno prostora a pored toga je jako isplativa. Same dimenzije ovih fikstura su male pa ih to čini jos povoljnijim.

U sledećoj tabeli\footnote{Vise o generaciji toplote na: budući da researchgate ima užasne linkove, rad ce biti na kraju.} ćemo detaljno pogledati razliku u proizvodnji toplote izmedju različitih tipova sijalica.


\begin{table}[ht]
  \caption{Proizvodnja toplote}
  \centering
  \begin{tabular}{|c|c|c|}
  \hline
    Tehnologija & Gubitak putem radijacije[\%] & Toplotni gubitak[\%] \\ \hline
  Inkandescentne sijalice & 81 - 86 & 5 - 6 \\ \hline
  fluorescentne sijalice & 30 - 32 & 44 \\ \hline
  HID(živa) & 62 - 65 & 16 - 22 \\ \hline
  HID(sodijum) & 57 - 74 & 7 - 20 \\ \hline
  HID(metal halogene) & 47.3 - 63.3 & 10 - 23 \\ \hline
  LED & 0 - 0.2 & 80 - 88 \\ \hline
  \end{tabular}
\end{table}

Kada gledamo snagu svetla, preporučeno je koristiti minimum 
\[35W po 1ft^2,\]

gde je optimalno 50W a maksimalno 80W. Ako pogledamo prostor sistema koji iznosi 1225$cm^2$ što je $~$1.40$ft^2$, biće dovoljno koristiti LED svetlo snage 150W (efektivno oko 100W) sa ugradjenim hladnjakom.



\subsection{Regulacija rada ventilatora}
Ventilatori nam koriste za razmenu vazduha sa okolinom. Sa druge strane, kako utičemo na njihovu brzinu jedinica ce se brže odnosno sporije hladiti.

Da bismo pronašli odgovarajuću veličinu ventilatora za sistem moramo odrediti samo prostor sa kojim radimo:

\[ 35cm * 35cm * 60cm =  73500cm^3 = 2.595628ft^3\]

Iz ovoga vidimo da su nam dovoljno obicni 12V ventilatori. Budući da se na izlaz kači filter vazduha koji u sebi sadrži dva 60mm ventilatora koji po specifikaciji pomeraju 38.35cfm a nasa jedinica ima samo ~2.5, na ulaz možemo staviti jedan ventilator od 120mm koji cemo uključivati u slucaju da nam temperatura predje dozvoljenu. Ovo radimo sa ciljem da unutar jedinice stvorimo negativni pritisak (izbacuje se vise nego sto ulazi) kako bi obezbedili da nam vazduh izlazi samo na predvidjenom mestu.

\noindent Prebacivanjem izduva sa 9V na 12V i ukljucivanjem usisa na 5V vrši se brža razmena toplote dok se temperature ne vrati na dozvoljeni nivo. 

\subsection{Zalivanje biljke}
Zalivanje biljke je jedan od elementarnih zahteva koje moramo ispuniti. Za ovo se koristi pumpa za vodu od 12V koja je potopljena u kanistar sa vodom. Pumpa se aktivira putem releja kada senzor vlage u zemlji detektuje niske količine vlage. Pre puštanja u rad potrebno je konfigurisati senzor. Ako senzor nije adekvatno kalibrisan može doći do preteranog zalivanja ili čak prelivanja vode unutar sistema.

\noindent Od velikog značaja je ravnomerna distribucija vode unutar saksije kako bi senzor stvarao sto realniju sliku o stanju unutar iste.



\subsection{Logovanje}
Logovanje nam omogućava detaljnu analizu procesa i samog rada naše mašine ako se korektno implementira. Znatno olakšava otkrivanje greške ili kvara, pomaže u rešavanju i služi kao output sistema. 

Generičan modul za sd kartice se koristi ovde koji ima sledeci pinout:

\hrulefill
\begin{itemize}
  \item VCC - 3.3V
  \item VCC - 5V
  \item MOSI
  \item CLK 
  \item MISO
  \item GND - ground
\end{itemize}
\hrulefill

Ovo ga čini idealnim za naše uslove. Na kartici će se beleziti svaki input koji sistem primi zajedno sa akcijom koja je izvrsena kroz vreme. \\

Ovakvo logovanje nam omogućava da pratimo rad mašine uz oslonac na grafike kroz vreme. Budući da imamo punu kontrolu nad formatiranjem podataka, možemo se postarati da izlaz bude kompatabilan sa nekim od popularnih softverskih alata. 

\section{Hardvesrki dizajn}

Posto smo odredili komponente koje odgovaraju nasim uslovima možemo stovriti grubu šemu sistema. Budići da softver(Eescheme) ne podržava breadboard(protoboard), veze poput 5V i zemlje sa arduina sam kačio na isti izlaz. U praksi ovo je uradjeno "proširivanjem" sa protobordom.

\includegraphics[width=\textwidth]{kontroler.png}

Ulaze i izlaze modula kačimo direktno na kontroler. Na relej se kači svetlo, pumpa za vodu i ventilatori(na jedan terminal kačimo 9V, a na drugi 12V).

\section{Softverski dizajn}

\subsection{Pokretanje i princip rada}

U inicijalnom setup petlji kontrolera inicijalizujemo sve potrebne biblioteke i promenljive. 

Glavna petlja ce pratiti sledeći sablon rada:

\hrulefill
\begin{itemize}
  \item Hvatanje temperature,
  \item hvatanje vlage zemlje,
  \item pokretanje pomoćne funckije koja odredjuje akcije u vidu zalivanja ili regulacije toplote,
  \item zapisivanje podataka i akcija,
  \item ispis na ekran.
\end{itemize}
\hrulefill

\subsection{Temperatura}

Hvatanje temperature vrsi se pozivom funkcije \verb|read_temperature()| koja će od senzora zatražiti trenutnu temperaturu. Ako je doslo do greske vratiće staru vrednost u protivnom biće vraćena očitana. 

\begin{lstlisting}
  /*
  * Funkcija za citanje temperature preko senzora
  * @return float - temp
  */
 float read_temperature(){
   //Var za temperaturu
   float tempC = sensors.getTempCByIndex(0);
   
   //Trazimo temperaturu
   Serial.print("Hvatam temperaturu");
   sensors.requestTemperatures();
   Serial.println("uspeh");
 
   Serial.print("Temperatura za device 1 (index 0) je: ");
   Serial.println(tempC);
 
   if(tempC != DEVICE_DISCONNECTED_C) return tempC;
 
   //Exception
   else Serial.println("Greska prilikom citanja!");
   return null;
 }
\end{lstlisting}
  
\subsection{Vlaga zemlje}

Što se vlage zemlje tiče proces je isti, funkcija izgleda ovako:

\begin{lstlisting}
  /*
 * Funkcija za citanje vlage zemlje preko senzora
 * @return float - soil_val
 */
float read_soil_moisture(){

	Serial.print("Hvatam vlagu");

	//citanje vlaznosti
	int soil_val = analogRead(SENSOR_PIN);

	//konverzija
	soil_val = map(soil_val, 550, 0, 0, 100);

	//ispis
	Serial.print("Vlaga: ");
	Serial.print(soil_val);

	return soil_val;
}
  \end{lstlisting}

  \subsection{Obrada učitanih vrednosti}

  Obrada vrednosti vrši se pozivom funkcije \verb|process_inputs|

  \begin{lstlisting}
    /*
    * Funkcija za kontrolu toka i logovanja
    * @param temp_val - temperatura
    * @param soil_val - vlaga
    */
   void process_inputs(float temp_val, float soil_val){
   
     if(temp_val>= 30)digitalWrite(relay1, HIGH);
     else digitalWrite(relay1, LOW);
   
     if(temp_val<=20)digitalWrite(relay1, LOW);
   
   }
    \end{lstlisting}

  
    \subsection{Ispis na ekran}

    Ova funkcija prvo konvertuje vrednosti u stringove i smešta ih u char niz. Nakon što su smešteni u svoje bafere pozivaju se funkcije za ispis.

    
  \begin{lstlisting}
    /*
     * Funkcija za ispis na ekran
     * @param temp_val - temperatura
     * @param soil_val - vlaga
     */
    void output_values(float temp_val, float soil_val){

	  //Pravimo char array za drawStr funkciju
	  String temp_string = String(temp_val);
	  String soil_string = String(soil_val);

	  char temp_buffer[5];
	  temp_string.toCharArray(temp_buffer, 5);

	  char soil_buffer[5];
	  soil_string.toCharArray(soil_buffer, 5);

	  //Ispis na ekran
	  temp_out(temp_buffer);
	  delay(2000);
	  soil_out(soil_buffer);  
  }
    \end{lstlisting}


\chapter{Izgradnja modela}

Kada smo definisali plan sistema možemo započeti izradu modela. U ovoj glavi posvetićemo se parametrima i njihovoj korelaciji unutar sistema. Kada su nam veze jasne, lako možemo napraviti model za simulaciju.

\section{Konceptualizacija modela}

Kako bismo stvorili koncept modela moramo se vratiti na funkcije našeg sistema. Analizom funkcija i konkretnog hardvera pronalazimo matematički model koji predstavlja temelj naše simulacije.\\




\section{Kolekcija podataka}

Podatke možemo prikupiti preko samih proizvodjača komponenti za koje smo se opredelili. Čitanjem tehničke dokumentacije ili samih specifikacija proizvoda možemo stvoriti gruba očekivanja kako će se sistem ponašati u realnim uslovima. \\

\noindent Bitno je imati na umu da vredonosti koje nam proizvodjač da uglavnom nisu merodavne pa je neophodno, ukoliko je to moguće, istraživanjem utvrditi realne performanse komponente. Ukoliko nije moguće naći iste, kako bi izbegli dodatne troskove, moramo uračunati do 30\% devijacije od datih.

\subsection{Regulacija temperature}

Za početak neophodno je odrediti izvore toplote unutar sistema. U našem slucaju to je LED svetlo od 150W koje, bez obzira na led tehnologiju, ipak proizvodi toplotu.\\

Testiranjem je utvrdjeno sledece:

\begin{table}[ht]
  \caption{Zagrevanje - bez aktivne ventilacije}
  \centering
  \begin{tabular}{|c|c|c|}
  \hline
    Trajanje[minut] & Temperatura[$^\circ$C] & Vreme\\ \hline
  0 & 25.3 & 9:48 \\ \hline
  15 & 28 & 10:03 \\ \hline
  30 & 29.1 & 10:18 \\ \hline
  60 & 29.1 & 10:48 \\ \hline
  \end{tabular}
\end{table}

\begin{table}[ht]
  \caption{Zagrevanje - aktivan izduv na 40\% snage}
  \centering
  \begin{tabular}{|c|c|c|}
  \hline
    Trajanje[minut] & Temperatura[$^\circ$C] & Vreme\\ \hline
  0 & 25.3 & 11:48 \\ \hline
  15 & 26.5 & 12:03 \\ \hline
  30 & 27.1 & 12:18 \\ \hline
  60 & 27.1 & 12:48 \\ \hline
  \end{tabular}
\end{table}

Predstavljeno graficki pomoću Matlab-a:

slika iz mat







\section{Prevodjenje modela}

\section{Verifikacija}

\section{Validacija}

\chapter{Izvršavanje simulacije}

\section{Dizajn eksperimenta}

\section{Izvršavanje i analiza}

\section{Dodatna izvršavanja}

\chapter{Implementacija}

\section{Dokumentacija i izveštaj}

\section{Implementacija}

\end{document}

%\section*{Acknowledgements}
%\begin{itemize}
%\item A special word of thanks goes to Professor Don Knuth\footnote{\url{http://www-cs-faculty.stanford.edu/~uno/}} (for \TeX{}) and Leslie Lamport\footnote{\url{http://www.lamport.org/}} (for \LaTeX{}).
%\item I'll also like to thank Gummi\footnote{\url{http://gummi.midnightcoding.org/}} developers and LaTeXila\footnote{\url{http://projects.gnome.org/latexila/}} development team for their awesome \LaTeX{} editors.
%\item I'm deeply indebted my parents, colleagues and friends for their support and encouragement.
%\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Sample table                                        %
% Source: www1.maths.leeds.ac.uk/latex/TableHelp1.pdf %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\begin{table}[ht]
 % \caption{Sample table} % title of Table
  %\centering % used for centering table
  %\begin{tabular}{c c c c}
  % centered columns (4 columns)
  %\hline\hline %inserts double horizontal lines
  %S. No. & Column\#1 & Column\#2 & Column\#3 \\ [0.5ex]
  % inserts table
  %heading
  %\hline % inserts single horizontal line
  %1 & 50 & 837 & 970 \\
  %2 & 47 & 877 & 230 \\
  %3 & 31 & 25 & 415 \\
  % & 35 & 144 & 2356 \\
  %5 & 45 & 300 & 556 \\ [1ex] % [1ex] adds vertical space
  %\hline %inserts single line
  %\end{tabular}
  %\label{table:nonlin} % is used to refer this table in the text
  %\end{table}